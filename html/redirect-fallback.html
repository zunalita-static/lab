<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Zunalita Redirect</title>
<p>
  You’ve reached this page through a Zunalita link.<br>
  This redirect service is used to safely forward you to an external website.<br>
  If you’re not automatically redirected, please check the link source or try again.
</p>

<noscript>
  <p style="color:red">
    JavaScript is required for redirection, please enable it and reload this page.
  </p>
</noscript>

<script>
const map = {
  "https://":"h~","http://":"p~","www.":"w~",
  ".com":".c",".org":".o",".net":".n"
};

function norm(u){
  return u.trim()
    .replace(/^https?:\/\//,"")
    .replace(/^www\./,"")
    .replace(/\/+$/,"")
    .toLowerCase();
}

function enc(u){
  u = norm(u);
  for(const [k,v] of Object.entries(map)) u = u.replaceAll(k,v);
  return btoa(u).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
}

function dec(s){
  let u = atob(s.replace(/-/g,"+").replace(/_/g,"/"));
  for(const [k,v] of Object.entries(map)) u = u.replaceAll(v,k);
  if(!/^https?:\/\//.test(u)) u = "https://" + u;
  return u;
}

function gen(u){
  const short = `${location.origin}${location.pathname}?c=${enc(u)}`;
  console.log("Short:", short);
  return short;
}

(()=>{
  const p = new URLSearchParams(location.search);
  const c = p.get("c");
  const f = p.get("f") === "true";

  if (c) {
    const u = dec(c);
    console.log("→ redirect:", u);
    location.replace(u);
    return;
  }

  if (f && document.referrer) {
    console.log("Fallback mode active — referrer found:", document.referrer);
    try {
      // tenta extrair o parâmetro "c" do referrer
      const refURL = new URL(document.referrer);
      const rc = refURL.searchParams.get("c");
      if (rc) {
        const u = dec(rc);
        console.log("→ redirect (from referrer):", u);
        location.replace(u);
        return;
      } else {
        console.warn("No ?c= param in referrer:", document.referrer);
      }
    } catch(e) {
      console.error("Invalid referrer:", e);
    }
  }

  console.warn("No redirect performed (no ?c= or valid referrer).");
})();
</script>
</html>
